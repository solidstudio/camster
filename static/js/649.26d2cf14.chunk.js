(self.webpackChunkopencv_cam=self.webpackChunkopencv_cam||[]).push([[649],{956:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var s=i(43),n=i(944),a=i(29),r=i.n(a),o=i(738),d=i(285),h=i.n(d);const l=e=>{let t=[];const i=h().minAreaRect(e).center;let s,n,a,r,o=0,d=0,l=0,c=0;for(let h=0;h<e.data32S.length;h+=2){const t={x:e.data32S[h],y:e.data32S[h+1]},u=Math.hypot(t.x-i.x,t.y-i.y);t.x<i.x&&t.y<i.y?u>o&&(s=t,o=u):t.x>i.x&&t.y<i.y?u>d&&(n=t,d=u):t.x<i.x&&t.y>i.y?u>l&&(a=t,l=u):t.x>i.x&&t.y>i.y&&u>c&&(r=t,c=u)}return t.push(s),t.push(n),t.push(r),t.push(a),t};class c extends Set{constructor(e){super(e);const t=[];for(let i of this)t.includes(i.name)?this.delete(i):t.push(i.name)}}const u=new class{constructor(){this.tasks=new c([]),this.fps=60,this.lastFrameTime=performance.now(),this.animationId=null,this.run=e=>{e-this.lastFrameTime>1e3/this.fps&&(this.tasks.forEach((t=>{e-t.lastFrameTime>1e3/t.fps&&(t.task(e),t.lastFrameTime=e)})),this.lastFrameTime=e),this.animationId=requestAnimationFrame(this.run)}}registerTask(e,t){this.tasks.add({task:e,fps:t,name:e.toString(),lastFrameTime:0}),1===this.tasks.size&&(this.animationId=requestAnimationFrame(this.run))}unregisterTask(e){this.tasks.delete(e),0===this.tasks.size&&null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};var m=i(579);const v=e=>{const[t,i]=(0,n.SF)(),a=s.useRef(null),d=s.useRef(null),c=(0,s.useRef)(null),v=(()=>{let e={facingMode:{exact:"user"},width:{ideal:1280},height:{ideal:720}};return o.Fr&&(e={facingMode:{exact:"environment"},width:{ideal:window.innerHeight},height:{ideal:window.screen.width}}),e})(),g=()=>{((e,t,i,s)=>{var n;const a=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.getCanvas();if(a){t.current.getContext("2d",{willReadFrequently:!0}).drawImage(e.current.video,0,0,a.width,a.height);const n=h().imread(t.current),r=Math.round(a.width*(i.documentWidth/100)),d=Math.round(a.height*(i.documentHeight/100));let l={x:a.width/2-r/4,y:a.height/2-d/2},c={x:a.width/2+r/4,y:a.height/2+d/2};o.Fr&&(l={x:a.width/2-r/2,y:a.height/2-d/2},c={x:a.width/2+r/2,y:a.height/2+d/2});const u=[255,255,255,255];if(h().rectangle(n,l,c,u,2),s&&i.debug){const e=[255,0,0,255];h().rectangle(n,s[0],s[2],e,2)}h().imshow(t.current,n),n.delete()}})(d,c,e,t.autoCapture.lastDetectedPoints)},w=()=>{((e,t,i,s)=>{var n;const a=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.video;a.height=a.videoHeight,a.width=a.videoWidth;const r=new(h().VideoCapture)(a),o=new(h().Mat)(a.height,a.width,h().CV_8UC4);r.read(o);const d=new(h().Mat);h().cvtColor(o,d,h().COLOR_RGBA2GRAY);const c=new(h().Mat);h().GaussianBlur(d,c,new(h().Size)(5,5),0,0,h().BORDER_DEFAULT),h().Canny(c,c,50,150);const u=new(h().Mat);h().threshold(c,u,0,255,h().THRESH_BINARY+h().THRESH_OTSU);let m=new(h().MatVector),v=new(h().Mat);h().findContours(u,m,v,h().RETR_CCOMP,h().CHAIN_APPROX_SIMPLE);let g=[];if(m.size()){let e=1e3,t=-1;for(let i=0;i<m.size();++i)h().contourArea(m.get(i))>e&&(t=i);if(t>=0){const i=m.get(t);h().contourArea(i)>e&&(g=l(i))}}o.delete(),d.delete(),c.delete(),u.delete(),m.delete(),v.delete(),g[0]&&g[2]&&s(g),g=[]})(d,0,0,f)},f=e=>{const s=t;s.autoCapture.lastDetectedPoints=e,i(s)};return(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("div",{ref:a,children:(0,m.jsx)(r(),{videoConstraints:v,ref:d,onUserMedia:()=>{setTimeout((()=>{((e,t)=>{var i;const s=null===e||void 0===e||null===(i=e.current)||void 0===i?void 0:i.video,n=t.current;n.width=s.videoWidth,n.height=s.videoHeight})(d,c),u.registerTask(g,60),u.registerTask(w,10)}),2e3)},style:{position:"absolute"}})}),(0,m.jsx)("div",{children:(0,m.jsx)("canvas",{id:"canvasOutput",ref:c,style:{position:"absolute"}})})]}),(0,m.jsx)("div",{style:{position:"relative"},children:(0,m.jsx)("a",{href:"/camster",children:"Back to settings"})})]})}},392:()=>{},562:()=>{},90:()=>{}}]);
//# sourceMappingURL=649.26d2cf14.chunk.js.map