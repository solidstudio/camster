(self.webpackChunkopencv_cam=self.webpackChunkopencv_cam||[]).push([[649],{956:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var s=i(43),n=i(944),a=i(738),o=i(29),r=i.n(o),l=i(664),d=i(285),h=i.n(d);const c=e=>{let t=[];const i=h().minAreaRect(e).center;let s,n,a,o,r=0,l=0,d=0,c=0;for(let h=0;h<e.data32S.length;h+=2){const t={x:e.data32S[h],y:e.data32S[h+1]},u=Math.hypot(t.x-i.x,t.y-i.y);t.x<i.x&&t.y<i.y?u>r&&(s=t,r=u):t.x>i.x&&t.y<i.y?u>l&&(n=t,l=u):t.x<i.x&&t.y>i.y?u>d&&(a=t,d=u):t.x>i.x&&t.y>i.y&&u>c&&(o=t,c=u)}return t.push(s),t.push(n),t.push(o),t.push(a),t};class u extends Set{constructor(e){super(e);const t=[];for(let i of this)t.includes(i.name)?this.delete(i):t.push(i.name)}}const g=new class{constructor(){this.tasks=new u([]),this.fps=60,this.lastFrameTime=performance.now(),this.animationId=null,this.run=e=>{e-this.lastFrameTime>1e3/this.fps&&(this.tasks.forEach((t=>{e-t.lastFrameTime>1e3/t.fps&&(t.task(e),t.lastFrameTime=e)})),this.lastFrameTime=e),this.animationId=requestAnimationFrame(this.run)}}registerTask(e,t){this.tasks.add({task:e,fps:t,name:e.toString(),lastFrameTime:0}),1===this.tasks.size&&(this.animationId=requestAnimationFrame(this.run))}unregisterTask(e){this.tasks.delete(e),0===this.tasks.size&&null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};var m=i(579);const v=()=>{let[e,t]=(0,n.SF)();e?e.config||(e.config=l.A.test):e={config:l.A.test},console.log("globalData",e),console.log("isMobile",a.Fr);const i=s.useRef(null),o=s.useRef(null),d=(0,s.useRef)(null),u=(()=>{let e={facingMode:{exact:"user"},width:{ideal:1280},height:{ideal:720}};return a.Fr&&(e={facingMode:{exact:"environment"},width:{ideal:window.innerHeight},height:{ideal:window.screen.width}}),e})(),v=()=>{((e,t,i,s)=>{var n;const o=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.getCanvas();if(o){t.current.getContext("2d",{willReadFrequently:!0}).drawImage(e.current.video,0,0,o.width,o.height);const n=h().imread(t.current),r=Math.round(o.width*(i.documentWidth/100)),l=Math.round(o.height*(i.documentHeight/100));let d={x:o.width/2-r/4,y:o.height/2-l/2},c={x:o.width/2+r/4,y:o.height/2+l/2};a.Fr&&(d={x:o.width/2-r/2,y:o.height/2-l/2},c={x:o.width/2+r/2,y:o.height/2+l/2});const u=[255,255,255,255];if(h().rectangle(n,d,c,u,2),s&&s.lastDetectedPoints&&i.debug){const e=[255,0,0,255];h().rectangle(n,s.lastDetectedPoints[0],s.lastDetectedPoints[2],e,2)}h().imshow(t.current,n),n.delete()}})(o,d,e.config,e.autoCapture)},f=()=>{((e,t,i,s)=>{var n;const a=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.video;a.height=a.videoHeight,a.width=a.videoWidth;const o=new(h().VideoCapture)(a),r=new(h().Mat)(a.height,a.width,h().CV_8UC4);o.read(r);const l=new(h().Mat);h().cvtColor(r,l,h().COLOR_RGBA2GRAY);const d=new(h().Mat);h().GaussianBlur(l,d,new(h().Size)(5,5),0,0,h().BORDER_DEFAULT),h().Canny(d,d,50,150);const u=new(h().Mat);h().threshold(d,u,0,255,h().THRESH_BINARY+h().THRESH_OTSU);let g=new(h().MatVector),m=new(h().Mat);h().findContours(u,g,m,h().RETR_CCOMP,h().CHAIN_APPROX_SIMPLE);let v=[];if(g.size()){let e=1e3,t=-1;for(let i=0;i<g.size();++i)h().contourArea(g.get(i))>e&&(t=i);if(t>=0){const i=g.get(t);h().contourArea(i)>e&&(v=c(i))}}r.delete(),l.delete(),d.delete(),u.delete(),g.delete(),m.delete(),v[0]&&v[2]&&s(v),v=[]})(o,0,e.config,w)},w=i=>{const s=e;s.autoCapture={lastDetectedPoints:i},t(s)};return(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("div",{ref:i,children:(0,m.jsx)(r(),{videoConstraints:u,ref:o,onUserMedia:()=>{setTimeout((()=>{((e,t)=>{var i;const s=null===e||void 0===e||null===(i=e.current)||void 0===i?void 0:i.video,n=t.current;n.width=s.videoWidth,n.height=s.videoHeight})(o,d,e.config),g.registerTask(v,60),g.registerTask(f,10)}),2e3)},style:{position:"absolute"}})}),(0,m.jsx)("div",{children:(0,m.jsx)("canvas",{id:"canvasOutput",ref:d,style:{position:"absolute"}})})]}),(0,m.jsx)("div",{style:{position:"relative"},children:(0,m.jsx)("a",{href:"/camster",children:"Back to settings"})})]})}},392:()=>{},562:()=>{},90:()=>{}}]);
//# sourceMappingURL=649.9f9143b0.chunk.js.map