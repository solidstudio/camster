(self.webpackChunkopencv_cam=self.webpackChunkopencv_cam||[]).push([[703],{994:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var s=i(43),n=i(475),a=i(944),o=i(738),r=i(29),l=i.n(r),d=i(634),h=i(285),c=i.n(h);const u=e=>{let t=[];const i=c().minAreaRect(e).center;let s,n,a,o,r=0,l=0,d=0,h=0;for(let c=0;c<e.data32S.length;c+=2){const t={x:e.data32S[c],y:e.data32S[c+1]},u=Math.hypot(t.x-i.x,t.y-i.y);t.x<i.x&&t.y<i.y?u>r&&(s=t,r=u):t.x>i.x&&t.y<i.y?u>l&&(n=t,l=u):t.x<i.x&&t.y>i.y?u>d&&(a=t,d=u):t.x>i.x&&t.y>i.y&&u>h&&(o=t,h=u)}return t.push(s),t.push(n),t.push(o),t.push(a),t};class g extends Set{constructor(e){super(e);const t=[];for(let i of this)t.includes(i.name)?this.delete(i):t.push(i.name)}}const m=new class{constructor(){this.tasks=new g([]),this.fps=60,this.lastFrameTime=performance.now(),this.animationId=null,this.run=e=>{e-this.lastFrameTime>1e3/this.fps&&(this.tasks.forEach((t=>{e-t.lastFrameTime>1e3/t.fps&&(t.task(e),t.lastFrameTime=e)})),this.lastFrameTime=e),this.animationId=requestAnimationFrame(this.run)}}registerTask(e,t){this.tasks.add({task:e,fps:t,name:e.toString(),lastFrameTime:0}),1===this.tasks.size&&(this.animationId=requestAnimationFrame(this.run))}unregisterTask(e){this.tasks.delete(e),0===this.tasks.size&&null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}};var v=i(579);const f=()=>{let[e,t]=(0,a.SF)();e?e.config||(e.config=d.A.test):e={config:d.A.test},console.log("globalData",e),console.log("isMobile",o.Fr);const i=s.useRef(null),r=s.useRef(null),h=(s.useRef(null),(0,s.useRef)(null)),g=(()=>{let e={facingMode:{exact:"user"},width:{ideal:1280},height:{ideal:720}};return o.Fr&&(e={facingMode:{exact:"environment"},width:{ideal:window.innerHeight},height:{ideal:window.screen.width}}),e})(),f=()=>{((e,t,i,s)=>{var n;const a=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.getCanvas();if(a){t.current.getContext("2d",{willReadFrequently:!0}).drawImage(e.current.video,0,0,a.width,a.height);const n=c().imread(t.current),r=Math.round(a.width*(i.documentWidth/100)),l=Math.round(a.height*(i.documentHeight/100));let d={x:a.width/2-r/4,y:a.height/2-l/2},h={x:a.width/2+r/4,y:a.height/2+l/2};o.Fr&&(d={x:a.width/2-r/2,y:a.height/2-l/2},h={x:a.width/2+r/2,y:a.height/2+l/2});const u=[255,255,255,255];if(c().rectangle(n,d,h,u,2),s&&s.lastDetectedPoints&&i.debug){const e=[255,0,0,255];c().rectangle(n,s.lastDetectedPoints[0],s.lastDetectedPoints[2],e,2)}c().imshow(t.current,n),n.delete()}})(r,h,e.config,e.autoCapture)},w=()=>{((e,t,i,s)=>{var n;const a=null===e||void 0===e||null===(n=e.current)||void 0===n?void 0:n.video;a.height=a.videoHeight,a.width=a.videoWidth;const o=new(c().VideoCapture)(a),r=new(c().Mat)(a.height,a.width,c().CV_8UC4);o.read(r);const l=new(c().Mat);c().cvtColor(r,l,c().COLOR_RGBA2GRAY);const d=new(c().Mat);c().GaussianBlur(l,d,new(c().Size)(5,5),0,0,c().BORDER_DEFAULT),c().Canny(d,d,50,150);const h=new(c().Mat);c().threshold(d,h,0,255,c().THRESH_BINARY+c().THRESH_OTSU);let g=new(c().MatVector),m=new(c().Mat);c().findContours(h,g,m,c().RETR_CCOMP,c().CHAIN_APPROX_SIMPLE);let v=[];if(g.size()){let e=1e3,t=-1;for(let i=0;i<g.size();++i)c().contourArea(g.get(i))>e&&(t=i);if(t>=0){const i=g.get(t);c().contourArea(i)>e&&(v=u(i))}}r.delete(),l.delete(),d.delete(),h.delete(),g.delete(),m.delete(),v[0]&&v[2]&&s(v),v=[]})(r,0,e.config,x)},x=i=>{const s=e;s.autoCapture={lastDetectedPoints:i},t(s)};return(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{style:{position:"relative"},children:[(0,v.jsx)("div",{ref:i,children:(0,v.jsx)(l(),{videoConstraints:g,ref:r,onUserMedia:()=>{setTimeout((()=>{((e,t)=>{var i;const s=null===e||void 0===e||null===(i=e.current)||void 0===i?void 0:i.video,n=t.current;n.width=s.videoWidth,n.height=s.videoHeight})(r,h,e.config),m.registerTask(f,60),m.registerTask(w,10)}),2e3)},style:{position:"absolute"}})}),(0,v.jsx)("div",{children:(0,v.jsx)("canvas",{id:"canvasOutput",ref:h,style:{position:"absolute"}})})]}),(0,v.jsx)("div",{style:{position:"relative"},children:(0,v.jsx)(n.N_,{to:"/",reloadDocument:!0,children:"Back to settings"})})]})}},392:()=>{},562:()=>{},90:()=>{}}]);
//# sourceMappingURL=703.cecd98fc.chunk.js.map